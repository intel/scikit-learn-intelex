

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Scaling on Distributed Memory (Multiprocessing) &mdash; daal4py 0.2019.2 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Examples" href="examples.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> daal4py
          

          
          </a>

          
            
            
              <div class="version">
                0.2019
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">About daal4py</a></li>
<li class="toctree-l1"><a class="reference internal" href="algorithms.html">Supported Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Scaling on Distributed Memory (Multiprocessing)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#it-s-easy">It’s Easy</a></li>
<li class="toctree-l2"><a class="reference internal" href="#single-program-multiple-data-spmd">Single Program Multiple Data (SPMD)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#supported-algorithms-and-examples">Supported Algorithms and Examples</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">daal4py</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Scaling on Distributed Memory (Multiprocessing)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/scaling.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="scaling-on-distributed-memory-multiprocessing">
<h1>Scaling on Distributed Memory (Multiprocessing)<a class="headerlink" href="#scaling-on-distributed-memory-multiprocessing" title="Permalink to this headline">¶</a></h1>
<div class="section" id="it-s-easy">
<h2>It’s Easy<a class="headerlink" href="#it-s-easy" title="Permalink to this headline">¶</a></h2>
<p>Only very minimal changes are needed to your daal4py code to allow it running on
a cluster of workstations. Initialize the distribution engine:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">daalinit</span><span class="p">()</span>
</pre></div>
</div>
<p>Add the distribution parameter to the algorithm construction:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kmi</span> <span class="o">=</span> <span class="n">kmeans_init</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;plusPlusDense&quot;</span><span class="p">,</span> <span class="n">distributed</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
</pre></div>
</div>
<p>When calling the actual computation provide a list of input files or
input arrays. The input list represents the partitioning of your data, e.g. each
file/array will be processed on a separate process:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">kmi</span><span class="o">.</span><span class="n">compute</span><span class="p">([</span><span class="n">file1</span><span class="p">,</span> <span class="n">file2</span><span class="p">,</span> <span class="n">file3</span><span class="p">,</span> <span class="n">file4</span><span class="p">])</span>
</pre></div>
</div>
<p>Finally stop the distribution engine:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">daalfini</span><span class="p">()</span>
</pre></div>
</div>
<p>That’s all for the python code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">daal4py</span> <span class="k">import</span> <span class="n">daalinit</span><span class="p">,</span> <span class="n">daalfini</span><span class="p">,</span> <span class="n">kmeans_init</span>
<span class="n">daalinit</span><span class="p">()</span>
<span class="n">kmi</span> <span class="o">=</span> <span class="n">kmeans_init</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;plusPlusDense&quot;</span><span class="p">,</span> <span class="n">distributed</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">kmi</span><span class="o">.</span><span class="n">compute</span><span class="p">([</span><span class="n">file1</span><span class="p">,</span> <span class="n">file2</span><span class="p">,</span> <span class="n">file3</span><span class="p">,</span> <span class="n">file4</span><span class="p">])</span>
<span class="n">daalfini</span><span class="p">()</span>
</pre></div>
</div>
<p>To actually get it exectued on several processes
se standard MPI mechanics, like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mpirun</span> <span class="o">-</span><span class="n">n</span> <span class="mi">4</span> <span class="n">python</span> <span class="o">./</span><span class="n">kmeans</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>The provided binaries use the Intel® MPI library, but can also be compiled for MPICH.</p>
</div>
<div class="section" id="single-program-multiple-data-spmd">
<h2>Single Program Multiple Data (SPMD)<a class="headerlink" href="#single-program-multiple-data-spmd" title="Permalink to this headline">¶</a></h2>
<p>daal4py provides a SPMD-mode, e.g. allows programming in the usual MPI style.
No worries, you do not need mpi4py or alike
for this (even though of course you are free to use it together with daal4py).</p>
<p>Any of the above algorithms return a the usable result on all processes if the
distribution engine was initialized for SPMD:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">daalinit</span><span class="p">()</span>
</pre></div>
</div>
<p>The only other difference to the above is that your program needs to tell each
process which file/array it should operate on. Like with other SPMD programs
this is usually done conditinally on the process id/rank. daal4py provides
<code class="docutils literal notranslate"><span class="pre">my_procid()</span></code> and <code class="docutils literal notranslate"><span class="pre">num_procs()</span></code> to do exactly that:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">kmi</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="s1">&#39;input-</span><span class="si">{}</span><span class="s1">.csv&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">my_procid</span><span class="p">()))</span>
</pre></div>
</div>
<p>Don’t forget to configure your algorithm with <code class="docutils literal notranslate"><span class="pre">distributed=True</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">daal4py</span> <span class="k">import</span> <span class="n">daalinit</span><span class="p">,</span> <span class="n">daalfini</span><span class="p">,</span> <span class="n">kmeans_init</span>
<span class="n">daalinit</span><span class="p">(</span><span class="n">spmd</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">kmi</span> <span class="o">=</span> <span class="n">kmeans_init</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;plusPlusDense&quot;</span><span class="p">,</span> <span class="n">distributed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">kmi</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="s1">&#39;input-</span><span class="si">{}</span><span class="s1">.csv&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">my_procid</span><span class="p">()))</span>
<span class="n">daalfini</span><span class="p">()</span>
</pre></div>
</div>
<p>Runnign SPMD programs works the same way:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mpirun</span> <span class="n">genv</span> <span class="n">DIST_CNC</span><span class="o">=</span><span class="n">MPI</span> <span class="o">-</span><span class="n">n</span> <span class="o">&lt;</span><span class="n">num</span><span class="o">-</span><span class="n">procs</span><span class="o">&gt;</span> <span class="n">python</span> <span class="o">&lt;</span><span class="n">your</span><span class="o">-</span><span class="n">program</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="supported-algorithms-and-examples">
<h2>Supported Algorithms and Examples<a class="headerlink" href="#supported-algorithms-and-examples" title="Permalink to this headline">¶</a></h2>
<p>The following algorithms support distribution:</p>
<ul class="simple">
<li>PCA (pca)<ul>
<li><a class="reference external" href="https://github.com/IntelPython/daal4py/blob/master/examples/pca_spmd.py">PCA</a></li>
</ul>
</li>
<li>SVD (svd)<ul>
<li><a class="reference external" href="https://github.com/IntelPython/daal4py/blob/master/examples/svd_spmd.py">SVD</a></li>
</ul>
</li>
<li>Linear Regression Training (linear_regression_training)<ul>
<li><a class="reference external" href="https://github.com/IntelPython/daal4py/blob/master/examples/linear_regression_spmd.py">Linear Regression</a></li>
</ul>
</li>
<li>Ridge Regression Training (ridge_regression_training)<ul>
<li><a class="reference external" href="https://github.com/IntelPython/daal4py/blob/master/examples/ridge_regression_spmd.py">Ridge Regression</a></li>
</ul>
</li>
<li>Multinomial Naive Bayes Training (multinomial_naive_bayes_training)<ul>
<li><a class="reference external" href="https://github.com/IntelPython/daal4py/blob/master/examples/naive_bayes_spmd.py">Naive Bayes</a></li>
</ul>
</li>
<li>K-Means (kmeans_init and kmeans)<ul>
<li><a class="reference external" href="https://github.com/IntelPython/daal4py/blob/master/examples/kmeans_spmd.py">K-Means</a></li>
</ul>
</li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="examples.html" class="btn btn-neutral" title="Examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Intel.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.2019.2',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>